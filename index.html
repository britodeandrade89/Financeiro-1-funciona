<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Controle Financeiro Bispo-Brito</title>
    
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#FF8A00">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Finanças BB">
    <link rel="apple-touch-icon" href="icon.svg">

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="index.css">
    
<script type="importmap">
{
  "imports": {
    "@google/genai": "https://aistudiocdn.com/@google/genai@^1.21.0",
    "react": "https://aistudiocdn.com/react@^19.2.0",
    "react-dom/": "https://aistudiocdn.com/react-dom@^19.2.0/",
    "react/": "https://aistudiocdn.com/react@^19.2.0/",
    "firebase/app": "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js",
    "firebase/auth": "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js",
    "firebase/firestore": "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js",
    "firebase/": "https://aistudiocdn.com/firebase@^12.5.0/"
  }
}
</script>
</head>
<body>
    <div id="splash-screen">
        <div class="splash-content">
            <div class="splash-logo">
                <svg width="60" height="60" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M2.27344 10.2344L12.0007 15.1011L21.728 10.2344L12.0007 5.36771L2.27344 10.2344Z" stroke="#FF8A00" stroke-width="2" stroke-miterlimit="10"/><path d="M12 21.0312V15.1006" stroke="#FF8A00" stroke-width="2" stroke-miterlimit="10" stroke-linecap="round" stroke-linejoin="round"/><path d="M18.8643 18.5977L15.4326 16.6328" stroke="#FF8A00" stroke-width="2" stroke-miterlimit="10" stroke-linecap="round" stroke-linejoin="round"/><path d="M5.13574 18.5977L8.56743 16.6328" stroke="#FF8A00" stroke-width="2" stroke-miterlimit="10" stroke-linecap="round" stroke-linejoin="round"/><path d="M21.7279 10.2344V13.7656C21.7279 14.282 21.4921 14.767 21.0827 15.068L13.082 20.0016C12.4475 20.443 11.5525 20.443 10.918 20.0016L2.91728 15.068C2.50785 14.767 2.27207 14.282 2.27207 13.7656V10.2344C2.27207 9.71797 2.50785 9.23297 2.91728 8.93203L10.918 3.99844C11.5525 3.55703 12.4475 3.55703 13.082 3.99844L21.0827 8.93203C21.4921 9.23297 21.7279 9.71797 21.7279 10.2344Z" stroke="#FF8A00" stroke-width="2" stroke-miterlimit="10" stroke-linecap="round" stroke-linejoin="round"/></svg>
                <span>Finanças Bispo Brito</span>
            </div>
            <h1>Bem-vindo(a) de volta!</h1>
            <div class="pin-input">
                <div class="pin-dot filled"></div>
                <div class="pin-dot filled"></div>
                <div class="pin-dot filled"></div>
                <div class="pin-dot filled"></div>
            </div>
            <button class="btn btn-large">Entrar</button>
        </div>
    </div>
    
    <div id="app-wrapper" class="hidden">
        <header id="app-header">
            <!-- Header content is dynamic -->
        </header>

        <main id="main-content">
             <!-- HOME VIEW -->
            <div id="view-home" class="app-view active">
                <div class="main-summary-card">
                    <div class="main-summary-balance">
                        <span>Saldo Total</span>
                        <h2 id="totalBalance">R$ 0,00</h2>
                    </div>
                    <div class="main-summary-income">
                        <span>Renda Disponível</span>
                        <p id="availableIncome">R$ 0,00</p>
                    </div>
                    <button class="visibility-btn">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path><circle cx="12" cy="12" r="3"></circle></svg>
                    </button>
                </div>

                <div class="secondary-summary-grid">
                    <div class="summary-card">
                        <span>Gastos do Mês</span>
                        <strong id="monthlyExpenses">R$ 0,00</strong>
                    </div>
                    <div class="summary-card">
                        <span>Saldo Mumbuca</span>
                        <strong id="mumbucaBalance">R$ 0,00</strong>
                    </div>
                </div>

                <div class="section">
                    <h3 class="section-title">Análise do Mês</h3>
                    <div id="overviewChartContainer">
                        <div id="overviewChart"></div>
                        <div id="overviewChartLegend"></div>
                    </div>
                </div>
            </div>

            <!-- EXTRATO VIEW -->
            <div id="view-extrato" class="app-view">
                 <div id="transactionsList" class="items-list"></div>
                 <button id="add-transaction-fab" class="fab">+</button>
            </div>

            <!-- METAS VIEW -->
            <div id="view-metas" class="app-view">
                <div id="goalsListContainer"></div>
                <div class="new-goal-btn-container">
                    <button id="add-goal-btn" class="btn btn-large">Criar Nova Meta</button>
                </div>
            </div>
            
            <!-- PERFIL VIEW -->
            <div id="view-perfil" class="app-view">
                <div class="profile-header">
                    <img src="https://i.pravatar.cc/150?u=familia-bispo-brito" alt="Família Bispo Brito" class="profile-pic">
                    <div class="profile-info">
                        <h2>Família Bispo Brito</h2>
                        <button class="edit-profile-btn">Editar Perfil</button>
                    </div>
                </div>

                <div class="profile-menu">
                    <button class="profile-menu-item">
                        <span class="profile-menu-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path><circle cx="12" cy="7" r="4"></circle></svg></span>
                        <span>Dados Pessoais</span>
                        <span class="profile-menu-arrow">&gt;</span>
                    </button>
                     <button class="profile-menu-item">
                        <span class="profile-menu-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"></path></svg></span>
                        <span>Segurança</span>
                        <span class="profile-menu-arrow">&gt;</span>
                    </button>
                     <button class="profile-menu-item">
                        <span class="profile-menu-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="3"></circle><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"></path></svg></span>
                        <span>Configurações</span>
                         <span class="profile-menu-arrow">&gt;</span>
                    </button>
                     <button class="profile-menu-item">
                        <span class="profile-menu-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"></path><line x1="12" y1="17" x2="12.01" y2="17"></line></svg></span>
                        <span>Ajuda</span>
                         <span class="profile-menu-arrow">&gt;</span>
                    </button>
                     <button class="profile-menu-item">
                        <span class="profile-menu-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path><polyline points="16 17 21 12 16 7"></polyline><line x1="21" y1="12" x2="9" y2="12"></line></svg></span>
                        <span>Sair</span>
                         <span class="profile-menu-arrow">&gt;</span>
                    </button>
                </div>
            </div>
        </main>

        <nav id="tab-bar">
            <button class="tab-btn active" data-view="home">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path><polyline points="9 22 9 12 15 12 15 22"></polyline></svg>
                <span>Início</span>
            </button>
            <button class="tab-btn" data-view="extrato">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path><polyline points="14 2 14 8 20 8"></polyline><line x1="16" y1="13" x2="8" y2="13"></line><line x1="16" y1="17" x2="8" y2="17"></line><polyline points="10 9 9 9 8 9"></polyline></svg>
                <span>Extrato</span>
            </button>
            <button class="tab-btn" data-view="metas">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path><polyline points="22 4 12 14.01 9 11.01"></polyline></svg>
                <span>Metas</span>
            </button>
             <button class="tab-btn" data-view="perfil">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path><circle cx="12" cy="7" r="4"></circle></svg>
                <span>Perfil</span>
            </button>
        </nav>

        <!-- MODALS -->
        <div id="addModal" class="modal">
            <div class="modal-content">
                <header class="modal-header">
                    <h2 id="addModalTitle" class="modal-title">Adicionar</h2>
                    <button class="action-btn close-modal-btn" title="Fechar">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
                    </button>
                </header>
                <form id="addForm">
                    <div class="form-group"><label for="description" class="form-label">Descrição</label><input type="text" id="description" name="description" class="form-input" required></div>
                    <div class="form-group"><label for="amount" class="form-label">Valor</label><input type="text" id="amount" name="amount" class="form-input" inputmode="decimal" required></div>
                    <div id="sourceAccountGroup" class="form-group"><label for="sourceAccount" class="form-label">Fonte do Pagamento</label><select id="sourceAccount" name="sourceAccount" class="form-select"></select></div>
                    <div id="typeGroup" class="form-group"><label for="type" class="form-label">Tipo</label><select id="type" name="type" class="form-select"><option value="fixed">Fixa</option><option value="variable">Variável</option></select></div>
                    <div id="categoryGroup" class="form-group"><label for="category" class="form-label">Categoria</label><select id="category" name="category" class="form-select"></select></div>
                    <div id="dateGroup" class="form-group" style="display: none;"><label id="transactionDateLabel" for="transactionDate" class="form-label">Data</label><input type="date" id="transactionDate" name="transactionDate" class="form-input"></div>
                    <div id="installmentsGroup" class="form-row">
                        <div class="form-group"><label for="currentInstallment" class="form-label">Parcela Atual</label><input type="number" id="currentInstallment" name="currentInstallment" class="form-input" placeholder="Ex: 2"></div>
                        <div class="form-group"><label for="totalInstallments" class="form-label">Total de Parcelas</label><input type="number" id="totalInstallments" name="totalInstallments" class="form-input" placeholder="Ex: 12"></div>
                    </div>
                    <div class="form-group-checkbox" id="cyclicGroup"><input type="checkbox" id="cyclic" name="cyclic"><label for="cyclic">Despesa Cíclica (Repete todo mês)</label></div>
                    <div class="modal-footer"><button type="submit" class="btn btn-large">Salvar</button></div>
                </form>
            </div>
        </div>
        
        <div id="editModal" class="modal">
             <div class="modal-content">
                <header class="modal-header">
                    <h2 id="editModalTitle" class="modal-title">Editar</h2>
                    <button class="action-btn close-modal-btn" title="Fechar">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
                    </button>
                </header>
                <form id="editForm">
                    <input type="hidden" id="editItemId" name="itemId">
                    <input type="hidden" id="editItemType" name="itemType">
                    <div class="form-group"><label for="editDescription" class="form-label">Descrição</label><input type="text" id="editDescription" name="description" class="form-input" required></div>
                    <div class="form-group"><label for="editAmount" class="form-label">Valor</label><input type="text" id="editAmount" name="amount" class="form-input" inputmode="decimal" required></div>
                    <div id="editSourceAccountGroup" class="form-group"><label for="editSourceAccount" class="form-label">Fonte do Pagamento</label><select id="editSourceAccount" name="sourceAccount" class="form-select"></select></div>
                    <div id="editCategoryGroup" class="form-group"><label for="editCategory" class="form-label">Categoria</label><select id="editCategory" name="category" class="form-select"></select></div>
                    <div id="editDueDateGroup" class="form-group"><label for="editDueDate" class="form-label">Vencimento</label><input type="date" id="editDueDate" name="dueDate" class="form-input"></div>
                    <div id="editPaidDateGroup" class="form-group"><label for="editPaidDate" class="form-label">Data de Pagamento</label><input type="date" id="editPaidDate" name="paidDate" class="form-input"></div>
                    <div id="editInstallmentsGroup" class="form-row">
                        <div class="form-group"><label for="editCurrentInstallment" class="form-label">Parcela Atual</label><input type="number" id="editCurrentInstallment" name="currentInstallment" class="form-input"></div>
                        <div class="form-group"><label for="editTotalInstallments" class="form-label">Total</label><input type="number" id="editTotalInstallments" name="totalInstallments" class="form-input"></div>
                    </div>
                    <p id="editInstallmentsInfo" style="display:none; text-align: center; color: var(--text-light); font-size: 0.8rem; margin-top: -0.5rem; margin-bottom: 1rem;">Alterar as parcelas aqui não afeta os meses futuros.</p>
                    <div class="modal-footer">
                        <button type="button" id="deleteItemBtn" class="btn btn-danger">Excluir</button>
                        <button type="submit" class="btn">Salvar</button>
                    </div>
                </form>
            </div>
        </div>
        
        <div id="aiModal" class="modal">
            <div class="modal-content">
                <header class="modal-header">
                    <h2 id="aiModalTitle" class="modal-title">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 3c-1.2 0-2.4.6-3 1.7A3.6 3.6 0 0 0 8.3 9c.5 1.1 1.4 2 2.7 2s2.2-.9 2.7-2c.1-.4.2-.8.3-1.3.6-1.1 0-2.3-1-3.1-.3-.2-.6-.3-1-.3z"></path><path d="M12 21c-1.2 0-2.4-.6-3-1.7A3.6 3.6 0 0 1 8.3 15c.5-1.1 1.4-2 2.7-2s2.2.9 2.7 2c.1.4.2.8.3 1.3.6 1.1 0 2.3-1 3.1-.3-.2-.6-.3-1 .3z"></path><path d="M3 12c0-1.2.6-2.4 1.7-3A3.6 3.6 0 0 1 9 8.3c1.1.5 2 1.4 2 2.7s-.9 2.2-2 2.7c.4.1.8.2-1.3.3-1.1.6-2.3 0-3.1-1 .2-.3-.3-.6-.3-1z"></path><path d="M21 12c0-1.2-.6-2.4-1.7-3A3.6 3.6 0 0 0 15 8.3c-1.1.5-2 1.4-2 2.7s.9 2.2 2 2.7c.4.1.8.2 1.3.3 1.1.6 2.3 0-3.1-1 .2-.3.3-.6-.3-1z"></path></svg>
                        Análise com IA
                    </h2>
                    <button class="action-btn close-modal-btn" title="Fechar">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
                    </button>
                </header>
                <div id="aiAnalysis"></div>
                <div class="modal-footer ai-footer">
                    <div id="aiSuggestionChips" class="ai-suggestion-chips">
                        <button id="generateSavingsSuggestionBtn" class="suggestion-chip">Dicas de economia</button>
                    </div>
                    <form id="aiChatForm">
                        <input type="text" id="aiChatInput" class="form-input" placeholder="Faça uma pergunta...">
                        <button type="submit" id="aiChatSendBtn" class="btn">
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="22" y1="2" x2="11" y2="13"></line><polygon points="22 2 15 22 11 13 2 9 22 2"></polygon></svg>
                        </button>
                    </form>
                </div>
            </div>
        </div>

        <div id="goalModal" class="modal">
             <div class="modal-content">
                <header class="modal-header"><h2 id="goalModalTitle" class="modal-title">Meta de Gastos</h2><button class="action-btn close-modal-btn">&times;</button></header>
                <form id="goalForm">
                    <input type="hidden" id="goalId" name="goalId">
                    <div class="form-group"><label for="goalCategory" class="form-label">Categoria</label><select id="goalCategory" name="goalCategory" class="form-select" required></select></div>
                    <div class="form-group"><label for="goalAmount" class="form-label">Valor Limite (R$)</label><input type="text" id="goalAmount" name="goalAmount" class="form-input" required inputmode="decimal"></div>
                    <div class="modal-footer"><button type="submit" class="btn btn-large">Salvar Meta</button></div>
                </form>
            </div>
        </div>

        <div id="savingsGoalModal" class="modal">
            <div class="modal-content">
                <header class="modal-header"><h2 id="savingsGoalModalTitle">Meta de Poupança</h2><button class="action-btn close-modal-btn">&times;</button></header>
                <form id="savingsGoalForm">
                    <input type="hidden" id="savingsGoalId" name="savingsGoalId">
                    <div class="form-group"><label for="savingsGoalDescription">Descrição</label><input type="text" id="savingsGoalDescription" name="savingsGoalDescription" class="form-input" required></div>
                    <div class="form-row">
                        <div class="form-group"><label for="savingsGoalCurrent">Valor Atual (R$)</label><input type="text" id="savingsGoalCurrent" name="savingsGoalCurrent" class="form-input" required inputmode="decimal"></div>
                        <div class="form-group"><label for="savingsGoalTarget">Objetivo (R$)</label><input type="text" id="savingsGoalTarget" name="savingsGoalTarget" class="form-input" required inputmode="decimal"></div>
                    </div>
                    <div class="modal-footer"><button type="submit" class="btn btn-large">Salvar Meta</button></div>
                </form>
            </div>
        </div>

        <div id="accountModal" class="modal">
            <div class="modal-content">
                <header class="modal-header"><h2 id="accountModalTitle">Conta Bancária</h2><button class="action-btn close-modal-btn">&times;</button></header>
                <form id="accountForm">
                    <input type="hidden" id="accountId" name="accountId">
                    <div class="form-group"><label for="accountName">Nome da Conta</label><input type="text" id="accountName" name="accountName" class="form-input" required></div>
                    <div class="form-group"><label for="accountBalance">Saldo (R$)</label><input type="text" id="accountBalance" name="accountBalance" class="form-input" required inputmode="decimal"></div>
                    <div class="modal-footer"><button type="submit" class="btn btn-large">Salvar Conta</button></div>
                </form>
            </div>
        </div>

    </div>
    <script type="module" src="index.tsx"></script>
</body>
</html>